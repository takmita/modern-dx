<script>
  new Vue({
    el: '#app',
    data: () => ({
      counter: "",
      showSwitch :false,
    }),
    vuetify: new Vuetify(),
    
    // async mounted (){
    //   await gasRun('readFromTable').then(function(dbValue){
    mounted (){
      gasRun('readFromTable').then(function(dbValue){
        // readFromTable成功時
        this.resetCounter(dbValue);
        // ボタンを表示する
        this.showSwitch = true;
      }.bind(this)).catch(function(){
        // エラー時
        alert('カウンター取得失敗');
      });
    },
    methods: {
      resetCounter(defalt) {
        this.counter = ("0000" + defalt).slice(-5);
      },
      addCounter() {
        let result = ++this.counter ;
        if (result == 99999)  {
          result = 1;
        }
        this.counter = ("0000" + result).slice(-5);
      },
      saveCounter() {
        gasRun('updateOneRecord',this.counter).then(function(){
        // updateOneRecord成功時
          alert('保存しました！');
        }.bind(this)).catch(function(){
        // エラー時
          alert('保存失敗');
        });
      },
    },
  });

  function gasRun(func, ...args){
    return new Promise(function(resolve, reject){
      google.script.run.withSuccessHandler(function(dbValue){
        resolve(dbValue);
      }).withFailureHandler(function(){
        reject();
      })[func](...args);
    });
  }
</script>
