<script>
  new Vue({
    el: '#app',
    data: () => ({
      counter: "",
      // ボタンは非表示で開始
      showSwitch :false,
      // オーバーレイはローディング開始したら表示
      overlay: false,
    }),
    vuetify: new Vuetify(),
    mounted (){
      // オーバーレイを表示する
      this.overlay = true;
      // ＤＢから値を取得する
      gasRun('readFromTable').then(function(dbValue){
        // readFromTable成功時
        this.resetCounter(dbValue);
        // カウンターを表示したらボタンを表示する
        this.showSwitch = true;
      }.bind(this)).catch(function(){
        // エラー時
        alert('カウンター取得失敗');
      }).finally(function(){
        // オーバーレイを非表示に切り替える
        this.overlay = false;
      }.bind(this));
    },
    methods: {
      resetCounter(defalt) {
        this.counter = ("0000" + defalt).slice(-5);
      },
      addCounter() {
        let result = ++this.counter ;
        if (result == 99999)  {
          result = 1;
        }
        this.counter = ("0000" + result).slice(-5);
      },
      saveCounter() {
        // オーバーレイを表示する
        this.overlay = true;
        gasRun('updateOneRecord',this.counter).then(function(){
        // updateOneRecord成功時
          alert('保存しました！');
        }.bind(this)).catch(function(){
        // エラー時
          alert('保存失敗');
        }).finally(function(){
          // オーバーレイを非表示に切り替える
          this.overlay = false;
        }.bind(this));
      },
    },
  });

  function gasRun(func, ...args){
    return new Promise(function(resolve, reject){
      google.script.run.withSuccessHandler(function(dbValue){
        resolve(dbValue);
      }).withFailureHandler(function(){
        reject();
      })[func](...args);
    });
  }
</script>
